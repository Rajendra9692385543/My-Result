<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Credit Report</title>
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<style>
    body { 
        font-family: "Segoe UI", Arial, sans-serif; 
        margin: 20px; 
        background: #f4f6f9; 
        color: #333; 
    }
    /* Header */
    .header {
        text-align: center;
        background: linear-gradient(135deg, #003366, #00509e);
        color: #fff;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    .header h2 { margin: 5px 0; font-size: 22px; }
    .header h3 { margin: 5px 0; font-weight: 400; }
    .header h4 { margin: 5px 0; font-weight: 300; }

    /* Student Info Card */
    .student-info {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        margin: 0 auto 25px;
        max-width: 950px;
    }
    .student-info h5 {
        margin-bottom: 15px;
        color: #00509e;
    }
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 12px;
    }
    .info-item strong {
        color: #003366;
    }
    .backlog {
        color: #d9534f;
        font-weight: bold;
    }

    /* Tables */
    table { 
        border-collapse: collapse; 
        width: 100%; 
        margin: 20px auto; 
        font-size: 14px; 
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }
    th, td { 
        border: 1px solid #eee; 
        padding: 10px 12px; 
        text-align: center; 
    }
    th { 
        background: #003366; 
        color: #fff; 
        font-weight: 600; 
        position: sticky;
        top: 0;
        z-index: 2;
    }
    tr:nth-child(even) { background: #f9fbff; }
    tr:hover td { background: #eef5ff; }

    /* Totals and Failures */
    .fail { 
        color: #fff; 
        background: #d9534f; 
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
    }
    .total-row { 
        font-weight: bold; 
        background: #e8f0ff; 
    }
    .semester-title { 
        font-weight: bold; 
        text-align: center; 
        background: #00509e; 
        color: #fff; 
        font-size: 15px;
    }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
    <h2>CENTURION UNIVERSITY OF TECHNOLOGY & MANAGEMENT</h2>
    <h3>{{ data.student_info.school }}</h3>
    <h4>PARALAKHEMUNDI CAMPUS</h4>
</div>

<!-- Student Info Card -->
<div class="student-info">
  <h5>ðŸŽ“ Student Information</h5>
  <div class="info-grid">
    <div class="info-item"><strong>Name:</strong> {{ data.student_info.name }}</div>
    <div class="info-item"><strong>Reg. No:</strong> {{ data.student_info.reg_no }}</div>
    <div class="info-item"><strong>Session:</strong> {{ data.student_info.session }}</div>
    <div class="info-item"><strong>Branch:</strong> {{ data.student_info.branch }}</div>
    <div class="info-item"><strong>Section:</strong> {{ data.student_info.section }}</div>
    <div class="info-item backlog"><strong>Total Backlog Credits:</strong> {{ data.student_info.total_backlog_credits }}</div>
  </div>
</div>
<div class="text-end mb-3">
  <a href="{{ url_for('download_credit_excel', reg_no=data.student_info.reg_no) }}" 
     class="btn btn-success">
     <i class="bi bi-download me-2"></i> Download as Excel
  </a>
</div>

<!-- --- Semester-wise detailed tables --- -->
{% for year, sems in data.semesters.items() %}
    <h4>{{ year }}</h4>
    {% for sem_name, subjects in sems.items() %}
    <table>
        <thead>
            <tr>
                <th colspan="10" class="semester-title">Semester {{ sem_name }}</th>
            </tr>
            <tr>
                <th>Sl. No</th>
                <th>Subject Code</th>
                <th>Subject</th>
                <th>Basket 1</th>
                <th>Basket 2</th>
                <th>Basket 3</th>
                <th>Basket 4</th>
                <th>Basket 5</th>
                <th>Grand Total</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody>
            {% for sub in subjects %}
            <tr>
                <td>{{ sub.sl_no }}</td>
                <td>{{ sub.code }}</td>
                <td>{{ sub.subject }}</td>
                {% for i in range(5) %}
                    <td>{% if sub.baskets[i] %}{{ sub.baskets[i] }}{% else %}-{% endif %}</td>
                {% endfor %}
                <td>{{ sub.baskets | sum }}</td>
                <td>
                    {% if sub.grade in ['F','S','BACKLOG'] %}
                        <span class="fail">{{ sub.grade }}</span>
                    {% else %}
                        {{ sub.grade }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            <tr class="total-row">
                <td colspan="3">Total</td>
                {% for b in data.totals[year][sem_name].baskets %}
                    <td>{{ b }}</td>
                {% endfor %}
                <td>{{ data.totals[year][sem_name].grand_total }}</td>
                <td></td>
            </tr>
        </tbody>
    </table>
    {% endfor %}
{% endfor %}

<!-- --- Overall Semester-wise Summary Table --- -->
<h4 class="mb-3">
  <i class="bi bi-graph-up-arrow text-primary me-2"></i>
  Semester-wise Academic Credit Analysis
</h4>
<table>
    <thead>
        <tr>
            <th>Semester</th>
            <th>Basket 1</th>
            <th>Basket 2</th>
            <th>Basket 3</th>
            <th>Basket 4</th>
            <th>Basket 5</th>
            <th>Grand Total</th>
        </tr>
    </thead>
    <tbody>
        {% for sem in data.semester_summary %}
            <tr>
                <td>Semester {{ sem.sem_number }}</td>
                {% for i in range(5) %}
                    <td>{% if sem.baskets[i] %}{{ sem.baskets[i] }}{% else %}-{% endif %}</td>
                {% endfor %}
                <td>{{ sem.grand_total }}</td>
            </tr>
        {% endfor %}
        <tr class="total-row">
            <td>Total Credits</td>
            {% for i in range(5) %}
                <td>{{ data.basket_sum[i] }}</td>
            {% endfor %}
            <td>{{ data.grand_sum }}</td>
        </tr>
    </tbody>
</table>

</body>
</html>
